name: Hanna Instruments - Database Deployment to Mittwald

on:
  push:
    branches: [main]
    paths:
      - 'shopware-database-deployment/**'
      - 'configs/**'
      - '.github/workflows/mittwald-deploy.yml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Prepare Database-only deployment
      run: |
        echo "ðŸ“¦ Bereite Datenbank-Deployment fÃ¼r Mittwald vor..."
        
        # Erstelle Deployment-Verzeichnis
        mkdir -p mittwald-deployment
        
        # Kopiere das bereits erstellte Datenbank-Deployment-Paket
        cp -r shopware-database-deployment/* mittwald-deployment/
        
        echo "âœ… Datenbank-Deployment vorbereitet"
        
    - name: Upload deployment package
      uses: actions/upload-artifact@v4
      with:
        name: mittwald-deployment-package
        path: mittwald-deployment/
        retention-days: 30
        
    - name: Deploy to Mittwald Studio
      uses: mittwald/deploy-container-action@v1.0.1
      with:
        api_token: ${{ secrets.MITTWALD_API_TOKEN }}
        stack_id: ${{ secrets.MITTWALD_STACK_ID }}
        stack_file: "${{ github.workspace }}/configs/stack.yaml"